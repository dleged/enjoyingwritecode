<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			pre{
				margin: 0;
				paddingï¼š10px;
				font-family: "agency fb";
			}
		</style>
		<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
	</head>
	<body>
		<pre>
			è§‚å¯Ÿè€…æ¨¡å¼åˆå«å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œ
			è®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬ä¸€ä¸ªä¸»é¢˜å¯¹è±¡ï¼Œè¿™ä¸ªä¸»é¢˜å¯¹è±¡çš„
			çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å°±ä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å¾—å®ƒä»¬èƒ½å¤Ÿ
			è‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚
		</pre>
		<pre>

			function createEvents<F extends Function>(): Events<F> {
				let handlers: F[] = [];

				return {
					get length() {
						return handlers.length;
					},
					push(fn: F) {
						handlers.push(fn);
						return function() {// ğŸ’…å¸è½½å‡½æ•°
							handlers = handlers.filter(handler => handler !== fn);
						};
					},
					call(arg) {
						handlers.forEach(fn => fn && fn(arg));
					}
				};
			}
		</pre>
		<script type="text/javascript">
			~(function(){
				var o = $({});

				$.jianting = function(){
					o.on.apply(o,arguments);
				}

				$.fabu = function(){
					o.trigger.apply(o,arguments);
				}

				$.qingchu = function(){
					o.off.apply(o,arguments);
				}

				$.jianting('test/ls',function(e,a,b){
					console.log(a + ' || ' + b)
				})
				$.jianting('test/ls',function(e,a,b){
					console.log('ok');
				})
				$.jianting('test/ls2',function(e,a,b){
					console.log(a + ' || ' + b)
				})
				$.jianting('test/ls2',function(e,a,b){
					console.log('ok2');
				})
				$.fabu('test/ls',[1,2]);
				$.fabu('test/ls2',[1,2]);
			})()

			/*å‘å¸ƒå®šäºå”®æ¥¼ä»·æ ¼*/
			Observer = {
				clientList: {},
				listen: function(key,fn){
					if(!this.clientList[key]){//è‹¥keyå‹å·çš„æ¥¼ç›˜æ²¡äººè®¢é˜…
						this.clientList[key] = [];
					}
					this.clientList[key].push(fn);
				},
				trigger: function(){//å‘å¸ƒ
					arguments = Array.prototype.slice.call(arguments);
					var key = arguments.shift();

					if(!this.clientList[key]){
						return false;
					}
					var fns = this.clientList[key];
					var fn = fns[0];
					for(var i = 0;fn;fn = fns[i+1]){
						fn.apply(null,arguments);
					}
				},
				remove: function(key,fn){
					var fns = this.clientList[ key ];
					if ( !fns ){ // å¦‚æœ key å¯¹åº”çš„æ¶ˆæ¯æ²¡æœ‰è¢«äººè®¢é˜…ï¼Œåˆ™ç›´æ¥è¿”å›
						return false;
					}
					if ( !fn ){ // å¦‚æœæ²¡æœ‰ä¼ å…¥å…·ä½“çš„å›è°ƒå‡½æ•°ï¼Œè¡¨ç¤ºéœ€è¦å–æ¶ˆ key å¯¹åº”æ¶ˆæ¯çš„æ‰€æœ‰è®¢é˜…
						fns && ( fns.length = 0 );
					}else{
						for ( var l = fns.length - 1; l >=0; l-- ){ // åå‘éå†è®¢é˜…çš„å›è°ƒå‡½æ•°åˆ—è¡¨
							var _fn = fns[ l ];
							if ( _fn === fn ){
						 		fns.splice( l, 1 ); // åˆ é™¤è®¢é˜…è€…çš„å›è°ƒå‡½æ•°
							 	}
						 	}
						}
					}
			}
			installEvent = function(obj){
				for(i in Observer){
					obj[i] = Observer[i];
				}
			}

			var salesOffices = {};
			salesOffices.name = 'salesOffices';
			installEvent( salesOffices );

			salesOffices.listen('æ’åšé˜³å…³åŸ1æ ‹',f1 = function(price){
				console.log('æ’åšé˜³å…³åŸ1æ ‹ï¼š',price,'å…ƒ');
			});
			salesOffices.listen('æ’åšé˜³å…³åŸ12æ ‹',f2 = function(price){
				console.log('æ’åšé˜³å…³åŸ12æ ‹ï¼š',price,'å…ƒ');
			});

			salesOffices.trigger('æ’åšé˜³å…³åŸ1æ ‹',20000)
			salesOffices.remove('æ’åšé˜³å…³åŸ1æ ‹',f1);
			salesOffices.trigger('æ’åšé˜³å…³åŸ1æ ‹',20000)
			salesOffices.trigger('æ’åšé˜³å…³åŸ1212æ ‹','2000');//æ²¡æœ‰è®¢é˜…
		</script>
	</body>
</html>
